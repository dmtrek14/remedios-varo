---
import { template } from '@/settings'

const currentPath = Astro.url.pathname;
const currentLocale = Astro.currentLocale || 'es';

// Generate the alternate language path for each language
function getLocalePath(locale: string) {
  // Remove any existing locale prefix and template base
  let path = currentPath;

  // Remove template base if present
  if (template.base && path.startsWith(template.base)) {
    path = path.substring(template.base.length);
  }

  // Remove locale prefix
  path = path.replace(/^\/(es|en)/, '');

  // Ensure path starts with /
  if (!path.startsWith('/')) {
    path = '/' + path;
  }

  // Add new locale prefix (except for Spanish which is default)
  if (locale === 'es') {
    return `${template.base}${path}`;
  } else {
    return `${template.base}/${locale}${path}`;
  }
}

const languages = [
  { code: 'en', label: 'English', flag: 'ðŸ‡ºðŸ‡¸' },
  { code: 'es', label: 'EspaÃ±ol', flag: 'ðŸ‡ªðŸ‡¸' },
];
---

<div class="dropdown dropdown-end" style="position: relative; z-index: 1000;">
  <div tabindex="0" role="button" class="btn btn-ghost btn-circle">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
      <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 21l5.25-11.25L21 21m-9-3h7.5M3 5.621a48.474 48.474 0 016-.371m0 0c1.12 0 2.233.038 3.334.114M9 5.25V3m3.334 2.364C11.176 10.658 7.69 15.08 3 17.502m9.334-12.138c.896.061 1.785.147 2.666.257m-4.589 8.495a18.023 18.023 0 01-3.827-5.802" />
    </svg>
  </div>
  <ul tabindex="0" class="menu menu-sm dropdown-content mt-3 p-2 shadow bg-base-100 rounded-box w-40" style="position: absolute; z-index: 9999;">
    {languages.map((lang) => (
      <li>
        <a
          href={getLocalePath(lang.code)}
          class={lang.code === currentLocale ? 'active' : ''}
        >
          <span class="text-lg">{lang.flag}</span>
          <span>{lang.label}</span>
        </a>
      </li>
    ))}
  </ul>
</div>
